<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
</head>
<body>
    <div id="app1">
                        <div class="px-md-5">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <button class="btn btn-transparent color-extras-gray" @click="last_month()"> <i
                                            class="fa-solid fa-angle-left color-dark-blue fa-lg me-3"></i> <span>{{ months[current_month - 1] }} {{current_year}}</span>
                                    </button>
                                </div>
                                <div>
                                    <h4 class="text-center mt-3 color-dark-blue"> <b> {{ months[current_month] }} {{current_year}} </b> </h4>
                                </div>
                                <div>
                                    <button class="btn btn-transparent color-extras-gray" @click="next_month()"> <span>{{ months[current_month + 1] }} {{current_year}}</span> <i
                                            class="fa-solid fa-angle-right color-dark-blue fa-lg ms-3"></i> </button>
                                </div>
                            </div>
                            <hr>
                        </div>
            
                        <div class="d-flex justify-content-end mt-3">
                            <button class="btn btn-blue-reserva me-5" @click="new_booking()"><span class="">Nueva Reserva</span> <i class="fa-solid fa-circle-arrow-right"></i> </button>
                        </div>
    
                        <div class="row my-3 px-2" style="max-width: 100%;">
                            <div class="col-12 col-lg-7 col-xl-7">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-transparent">
                                        <i class="fa-solid fa-square color-blue"></i>
                                        <span class="color-dark-extras">Fecha Reservada</span>
                                    </button>
                                    <button class="btn btn-transparent color-light-blue">
                                        <i class="fa-solid fa-square"></i>
                                        <span class="color-dark-extras">Fecha Bloqueada Parcialmente</span></button>
                                    <button class="btn btn-transparent color-dark-red">
                                        <i class="fa-solid fa-triangle-exclamation me-2"></i>
                                        <span>No hay suficiente personal para cubrir todos los turnos del día</span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-12 col-lg-1 col-xl-2"></div>
                            <div class="col-12 col-lg-4 col-xl-3">
                                <div class="d-flex justify-content-between">
                                    <select class="select-gray form-select me-3" v-model="filtros.vote_id" @change="filtrar_por_barco()">
                                        <option value="">Ver todos los barcos</option>
                                        <option v-for="(i, index) in botes" :key="index" :value="i.id"> {{ i.nombre }} </option>
                                    </select>
                                    <button class="btn bg-dark-blue color-white w-3rem me-3">
                                        <i class="fa-solid fa-bars"></i>
                                    </button>
                                    <button class="btn bg-dark-blue color-white w-3rem">
                                        <i class="fa-solid fa-calendar-days"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                
                        <div class="container-fluid table-responsive" >
                            <table class="table table-td-0 table-bordered equals">
                                <thead class="bg-dark-blue color-white">
                                    <tr>
                                        <th v-for="(i, index1) in days" :key="index1" > {{i}} </th>
                                    </tr>
                                </thead>
                                <tbody v-if="calendar_vue_length != 0">
                                    <tr v-for="(semana, key) in calendar_vue" :key="key">
                                        <td v-for="(i, index) in semana" :key="index" style="height: 7rem;" v-bind:class="[i.length > 0] ? 'cursor-pointer' : ''">
                                            <!-- {{ semana }} -->
                                            <!-- {{ start_day() }}  =======> {{show_day}} >= {{position}}  -->
                                            <div class="d-flex flex-column" v-if="start_day()">
                                                <div class="d-flex">
                                                    <button class="btn-day">{{ dia_num_function() }}</button>
                                                    <button class="btn btn-transparent color-dark-red" v-if="i.length > 0">
                                                        <i class="fa-solid fa-triangle-exclamation ps-2"></i>
                                                    </button>
                                                </div>
                                                <div class="d-flex justify-content-between in_progress ps-2 mb-1" v-for="(reserva, position) in i" :key="position">
                                                    <!-- {{reserva.id}} -->
                                                    <div @click="redirect(i)">
                                                        <button class="btn btn-transparent"> <i class="fa-solid fa-square fa-xs"></i> </button>
                                                        <strong> {{ reserva.hora_inicio }} - {{ reserva.hora_fin }} </strong>
                                                        <span>{{ reserva.nombre }}</span>
                                                    </div>
                                                    <a  href="#"></a>
                                                    <button class="btn btn-transparent color-dark-blue button-ellipsis" @click="details(reserva)"><i class="fa-solid fa-ellipsis button-ellipsis"></i></button>
                                                    <hr class="my-1 mx-2" style="opacity: .1;">
                                                </div>
                                                <!-- <div class="d-flex justify-content-between not_in_progress ps-2">
                                                    <div>
                                                        <button class="btn btn-transparent"> <i class="fa-solid fa-square fa-xs"></i> </button>
                                                        <strong> 10:00 - 14:00 </strong>
                                                        <span>Namaré</span>
                                                    </div>
                                                    <button class="btn btn-transparent color-dark-blue button-ellipsis"><i class="fa-solid fa-ellipsis button-ellipsis"></i></button>
                                                </div> -->
                                            </div>
                                            <div v-else>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
    </div>
</body>
</html>

<!-- </body>
</html> -->

<!-- <template> -->
        <!-- </template> -->
    <script>
        const {
            createApp
        } = Vue

    
        createApp({
            data() {
                return {
                    days: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
                    days_english: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                    botes: [],
                    today: new Date(),
                    cant_days_month: 0,
                    first_day: '',
                    position: 9999,
                    // show_day: -1,
                    calendar: [],
                    calendar_vue: [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [],[],[],[], [], [], [], []],
                    calendar_vue_length: 35,
                    day_vue: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35],
                    dia_num: 0,
                    filtros: {vote_id: ""},
                    show_day: -3400,
                    current_month: new Date().getMonth() + 1,
                    current_year: new Date().getFullYear(),
                    months: ['Diciembre','Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre', 'Enero'],
                }
            },
            created() {
                this.getBarcos()
                this.startMonth()
            },
            updated() {
                // this.dia_num = 0
                console.log('%c updated', 'color:red;')
            },
            methods: {
                dia(){
                    if(this.dia_num == 31) this.dia_num = 0
                    this.dia_num++
                    return this.dia_num
                },
                async getBarcos() {
                    alert('0')
                    // let url = 'https://rutaapp.com/boats/wp-content/themes/twentytwentytwo/ReservaController.php'
                    console.log('this.current_month aa ==> ', this.current_month);
                    let url = 'https://rutaapp.com/boats/wp-content/themes/twentytwentytwo/ReservaController.php?month=' + this.current_month + '&year=' + this.current_year
                    await axios.get(url).then(res => {
                        this.botes = res.data.botes
                        this.calendar = res.data.calendar
                        this.map_calendar()
                    })
                },
                daysByMont(mes, anio) {
                    return new Date(anio, mes, 0).getDate();
                },
                startMonth(){
                    let year = this.today.getFullYear()
                    let month = this.today.getMonth() + 1
                    this.first_day = new Date(this.today.getFullYear() + '-' + (parseInt(this.today.getMonth()) + 1) + '-' + '1').toDateString().substring(0,3)
                    this.days_english.forEach((ele, index) => {
                        if(ele == this.first_day) {
                            this.position = index
                        }
                    });

                    this.cant_days_month = this.daysByMont(month, year)
                    console.log('this.position ==> ', this.position);
                },
                start_day(){
                    // console.log('start_day()');
                    this.show_day++
                    if(this.show_day > this.position) {
                        return true
                    }else {
                        // this.day_vue.unshift(0)
                        return false
                    }
                },
                map_calendar(){
                    console.log('map_calendar()');
                    let days = []
                    for (let index = 0; index < this.cant_days_month; index++) {
                        days.push(index+1)
                    }
                    let calendar_vue = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [],[],[],[], [], [], [], []]
                    days.forEach((ele, index) => {
                        // console.log('%c entro a foreach', 'color:red;');
                        let date = new Date()
                        let month = date.getMonth() + 1
                        if(month < 10) month = '0' + month
                        if(ele < 10) ele = '0' + ele
                        date = date.getFullYear() + '-' + month + '-' + ele
                        this.calendar.forEach((row) => {
                            if(date == row.fecha) calendar_vue[index+this.position+1].push(row)
                        });
                    }) 
                    let semana1 = calendar_vue.splice(1,7)
                    let semana2 = calendar_vue.splice(1,7)
                    let semana3 = calendar_vue.splice(1,7)
                    let semana4 = calendar_vue.splice(1,7)
                    let semana5 = calendar_vue.splice(1,7)
                    this.calendar_vue = [semana1, semana2, semana3, semana4, semana5]
                    console.log('calendar_vue ==> ', calendar_vue);
                },
                redirect(reserva, type){
                    if(reserva.length > 0) {
                        window.location.href = "https://rutaapp.com/boats/wp-content/themes/twentytwentytwo/home.html?fecha=" + reserva[0].fecha
                    }
                },
                details(reserva, type) {
                    window.location.href = "https://rutaapp.com/boats/wp-content/themes/twentytwentytwo/ResumeReservaAdmin.html?reserva_id=" + reserva.id
                    console.log('reserva_detail ==> ', reserva);
                },
                new_booking() {
                    window.location.href = 'https://rutaapp.com/boats/reserva/'
                },
                dia_num_function() {
                    return this.dia_num+=1
                },
                next_month() {
                    if(this.current_month < 12) {
                        this.current_month++
                    }else{
                        this.current_month = 1
                        this.current_year++
                    }
                    this.show_day = -3490
                },
                last_month() {
                    if(this.current_month > 1) {
                        this.current_month--
                    }else{
                        this.current_month = 12
                        this.current_year--
                    }
                    this.show_day = -3490
                },
                func(){
                    console.log('func ==> entro');
                },
                filtrar_por_barco() {
                    this.show_day = -3400
                    axios.post('')
                    console.log('this.filtros.vote_id ==> ', this.filtros.vote_id);
                },
                getBarcos() {
                    // let url = 'https://rutaapp.com/boats/wp-content/themes/twentytwentytwo/ReservaController.php'
                    let url = 'https://rutaapp.com/boats/wp-content/themes/twentytwentytwo/ReservaController.php'
                    axios.get(url).then(res => {
                        this.botes = res.data.botes
                        this.calendar = res.data.calendar
                        this.map_calendar()
                    })
                },
            },
            computed: {
                
            }
        }).mount('#app1')
    </script>

    <style>
        .cursor-pointer {
            cursor: pointer;
        }
    </style>